---
title             : "Mapping correlates of adolescent emotion dysregulation: A text-mining based systematic review"
shorttitle        : "ADOLESCENT EMOTION DYSREGULATION"

author: 
  - name          : "Caspar J. van Lissa"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Padualaan 14, 3584CH Utrecht, The Netherlands"
    email         : "c.j.vanlissa@uu.nl"

affiliation:
  - id            : "1"
    institution   : "Utrecht University faculty of Social and Behavioral Sciences, department of Methodology & Statistics"

authornote: |
  This work is supported by a NWO Veni grant (NWO
  grant number VI.Veni.191G.090). Acknowledgement: Lukas Beinhauer contributed
  substantially to the screening of articles. Conflicts of Interest: None.
  

abstract: |
  Adolesence is a developmentally sensititve period for emotion dysregulation.
  Although substantial empirical research has addressed relevant risk factors,
  the literature is fragmented across subdisciplines, and
  an integrating framework is lacking.
  This systematic review of 6305 papers used text mining to map correlates of adolescents’ (ages 
  10-25) emotion dysregulation. First, we established a baseline of relevant terms gleaned from 
  theory and recent narrative reviews. Then, we conducted two text mining analyses to examine 
  term/document frequency and co-occurrence in author-provided keywords and abstracts. Results 
  reﬂected constructs commonly featured in theory and narrative reviews, but also identified 
  underrepresented themes. This research constitutes a first step towards integrating the 
  literature, and illustrates how text mining reviews may complement narrative reviews.

wordcount         : "6311"
bibliography      : ["veni_sysrev.bib"]
floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : no
mask              : no
draft             : no
documentclass     : "apa6"
classoption       : "man,noextraspace"
output            : papaja::apa6_docx
knit              : worcs:::cite_essential
header-includes:
  - \raggedbottom
---

```{r setup, include = FALSE}
library("papaja")
library(data.table, quietly = TRUE, warn.conflicts = FALSE)
library(knitr)
library(kableExtra)
library(cowplot)
run_everything <- TRUE
notingraph <- list()
keyw <- function(x){
  x
}
```
<!-- Reviewer suggestions:
Kristin Buss -->

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed, echo = FALSE, message = FALSE, warning = FALSE, results="hide")
```

A key developmental challenge in adolescence is acquiring mature emotion
regulation skills [@croneUnderstandingAdolescencePeriod2012;
@zimmermannEmotionRegulationEarly2014]. Emotion regulation is integral to
mental health [@aldaoEmotionregulationStrategiesPsychopathology2010;
@schaferEmotionRegulationStrategies2017; @braetEmotionRegulationChildren2014]
and social functioning [@reindlSocializationEmotionRegulation2016]. For as many
as one in five individuals, adolescence marks the onset of emotion
regulation-related mental illness, which can persist throughout the life course
[see @leeAdolescentMentalHealth2014]. 
It is therefore crucial to identify which
risk factors and environmental hazards render some adolescents more susceptible
to emotional difficulties than others. <!--SH: Main goal of paper -->
Although there is an abundance of empirical work on adolescents' emotion regulation, the literature is somewhat fragmented, because the topic has been investigated from different (sub)disciplines.
As a result, there is a lack of unifying theory,
and intrinsic limitations of narrative reviews prohibit comprehensive coverage of the vast but diffuse literature [@bussTheoriesEmotionalDevelopment2019].

The present systematic review addressed these limitations by adopting a novel method:
the text mining based systematic review.
We set out to map the constructs associated with adolescent emotion regulation based on a systematic review of the empirical literature.
Traditional narrative literature reviews have been shown to be marred by reliance on small convenience samples of the literature, confirmation bias,
and an undue emphasis on positive results [@littellEvidencebasedBiasedQuality2008]. 
Text mining, by contrast, is uniquely suited to provide a comprehensive overview of the literature.
It can cover vastly greater corpora than a human reader,
and the process by which text mining gleans insights from the literature is more objective, transparant, and reproducible.
Where human readers might be inclined to structure their reading of the literature around established ideas,
the inherent "fairness" of text mining gives emerging themes in the literature a chance to come to the fore.
Text mining identifies important topics in a body of literature and reveals which constructs are often studied together.
This potentially reveals topics and connections missed by narrative reviewers,
thereby laying the groundwork for future empirical and theoretical work. <!-- CJ To fill out gaps, following up on promising constructs and unify heretofore disparate regions of the lit -->
<!-- SH: this implies that the main contribution of the paper is predominantly methodological is that the case? Is there some primary thesis/argument that will be advanced? It is really important to take a top-down approach to that messaging, beginning here in the first paragraph-->
<!-- Ergens anders: Similarly, although
there are several *relevant* theories, there is no specific theoretical
framework to guide research on adolescents' emotion regulation. Although theory
development is beyond the scope of this paper, we set out to generate a
proto-theoretical nomological network of the potential risk factors,
manifestations, and outcomes of emotion regulation in adolescence. We discuss
how this nomological network relates to existing relevant theory, and conclude
with recommendations for future theory-generating efforts.-->

## Why adolescence is an important life stage for emotion regulation

Adolescence is defined as a life stage ranging from pubertal onset to
adult-like independence [@steinbergAgeOpportunityLessons2014].
It is thus demarcated by both biological and socio-cultural factors.
It has been argued that,
due to accellerated pubertal onset and delayed transitions to adult roles,
adolescence now ranges from 10-24 years in the modern Western world
[@sawyerAgeAdolescence2018].
<!-- From Barriola:
* adolescence, more than adulthood or childhood, is characterized by frequent
and intense emotions (Larson et al. 1980; Larson and Lampmanpetraitis 1989).
* signi?cant psychosocial changes that call for an increase in sophistication
of ER strategies (Steinberg 2005)
* novel stressors associated with social relationships, including pressures to
conform to adult expectations relating to maturity, educational achievement,
gender appropriate conduct, and other socially competent behaviors (Yap et al.
2007)
* Additionally, adolescents have an increased orientation toward autonomy
(Spear 2000) including autonomous emotional regulation-->
Adolescence is increasingly seen as a developmentally sensitive period for
mature emotion regulation skills. During this period, children experience rapid
biological, cognitive, and social changes that prompt new emotional
experiences, and tax existing regulatory abilities
[@steinbergAgeOpportunityLessons2014]. At the same time, the staggered
development of motivational-emotional and regulatory brain circuits gives rise
to a maturity gap [@croneUnderstandingAdolescencePeriod2012]. 
This leads youngsters to pursue new experiences in life and love,
without being fully prepared to cope with the emotional outcomes.
Due to these coalescing changes,
adolescents display a restricted repertoire of emotion regulation strategies
compared to younger or older individuals
[@zimmermannEmotionRegulationEarly2014]. Consequently, adolescents experience
more frequent and intense (negative) emotions than children or adults [see
@silkAdolescentsEmotionRegulation2003]. The literature thus paints a picture of
adolescence as a chrysalis for emotional development: Children enter this stage
with emotion regulation skills adapted to the challenges of childhood. During
adolescence, emotional systems are rearranged substantially. These changes
render adolescents temporarily vulnerable to emotional dysregulation, but
ultimately serve a functional role in acquiring mature emotion regulation
skills. Eventually, most adolescents emerge ready to take on the challenges of
early adulthood. Unfortunately, a sizeable proportion of adolescents instead
manifests enduring emotional difficulties [@leeAdolescentMentalHealth2014].

<!--
* intense negative emotions in daily life (Silk, Steinberg, & Morris, 2003) 
* unstable peer or romantic relationships (Furman & Collins, 2009)
* decrease in perceived support from parents (Furman & Buhrmester, 1992).
* early adolescence is characterized by a higher rate of conflicts with parents (Laursen, Coy, & Collins, 1998)
* higher variability of negative emotions compared to late adolescence (Larson, Moneta, Richards, & Wilson, 2002).
* relative to other developmental stages, adolescence involves a particularly large number of transitions, novel situations, and new stimuli, physical, cognitive, emotional, and social development—particularly in early and mid-adolescence (Seiffge-Krenke, 2000)
-->

## The consequences of difficulties in emotion regulation

<!--Acquiring mature emotion regulation abilities is important, because t-->The
consequences of difficulties in emotion regulation are extensive,
well-documented, and persist throughout the life course. Meta-analyses indicate
that such difficulties are associated with internalizing, and to a lesser extent, externalizing, psychopathology
[@aldaoEmotionregulationStrategiesPsychopathology2010;
@schaferEmotionRegulationStrategies2017]. 
Individuals who engage in maladaptive
emotion regulation strategies also experience more negative emotions,
diminished well-being, and greater strain in interpersonal relationships
[@grossIndividualDifferencesTwo2003a; @bellRelationshipsInputsOutputs2000].
<!--Adolescence also appears to be a key period for developing mature emotion
regulation skills - but not all adolescents do so successfully. As many as one
in five adolescents instead develop severe emotional difficulties.--> 
Given the
prevalence of emotional difficulties and their implications for
individual mental health, wellbeing, and social functioning, and their downstream
cost to society as a whole [@leeAdolescentMentalHealth2014], it is essential to
have a solid understanding of the risk factors associated with adolescents'
emotion regulation difficulties.

## Existing theoretical landscape

Our text mining analysis of the empirical literature is best understood against a backdrop of the existing theoretical landscape.
We therefore provide a summary theoretical review.
Other recent publications offer more detailed reviews of theories of emotional development [@bussTheoriesEmotionalDevelopment2019] and emotion regulation in adolescence [@riedigerEmotionRegulationAdolescence2014].
The correlates of emotion regulation difficulties discussed in our theoretical review
are summarized in Figure \@ref(fig:baseline)^[Based on an author-curated list of keywords, caterogized using the dictionary method introduced in Analysis 1.].

```{r baseline, warning=FALSE, eval = TRUE, results='asis', out.width = "100%", fig.cap="Correlates of emotion regulation difficulties according to theory (left panel) and narrative reviews (right panel). Transparent circles indicate constructs also represented in the theory."}
source("baseline.R", local = TRUE)
knitr::include_graphics("baseline_network.png") 
#fig_svg <- cowplot::ggdraw()+cowplot::draw_image("s1_varimp.svg")
#plot(fig_svg)

```

Among the oldest relevant theories of adolescents' emotional development is Hall's notion of "storm and stress" [see
@arnettAdolescentStormStress1999]. It describes how `r keyw("hormonal")` changes diminish
`r keyw("self-control")` and increase `r keyw("reactivity")`, leading to emotion
dysregulation, `r keyw("conflict with parents")`, and `r keyw("risky behavior")`.
This notion of diminished self-control and increased emotional reactivity persists in modern theory, but is now considered a normative change that facilitates emotional maturation
[@croneUnderstandingAdolescencePeriod2012], at the risk of emotional
disturbance [@arnettAdolescentStormStress1999; @leeAdolescentMentalHealth2014].

<!--SH I am still not sure what the empirical contribution is - can you be more specific with it in this sentence? -->
<!--Several recent publications have undertaken the
monumental task of providing a comprehensive overview of theories of emotional
development [e.g., @bussTheoriesEmotionalDevelopment2019;
@holodynskiDevelopmentEmotionsEmotion2006;
@riedigerEmotionRegulationAdolescence2014], and of the empirical work
pertaining to emotions in adolescence
[@coe-odessEmergentEmotionsAdolescence2019].  -->

One example of a normative theory of emotional development in early childhood is presented by Sroufe [-@sroufeEmotionalDevelopmentOrganization1995].
Sroufe argues that, as children grow older,
their increasing `r keyw("self-regulatory")` abilities
drive a transition from external emotion regulation by `r keyw("primary caregivers")`
towards autonomous emotion regulation. This theory focuses on two drivers of
development: `r keyw("social")` and `r keyw("cognitive influences")`. Social influences mainly occur
through `r keyw("parental co-regulation")`, `r keyw("parenting behaviors")`, and parent-child
`r keyw("attachment")`. Cognitive influences occur through the development of the `r keyw("central
nervous system")` (CNS), `r keyw("cognition")`, and `r keyw("self-regulation")`.

This emphasis on social influences and `r keyw("neurocognitive development")` is reflected in many theories.
Some of these focus primarily on neurocognitive development.
For example, `r keyw("polyvagal theory")` closely links `r keyw("emotional experience")`
- and regulation - to autonomous nervous system functioning
[@porgesOrientingDefensiveWorld1995].
More recently, in their model of social-affective engagement and `r keyw("goal flexibility")`
<!--. Like other authors 
[e.g., @caseyBrakingAcceleratingAdolescent2011; @craccoEmotionRegulationChildhood2017],
Crone and Dahl--> Crone and Dahl [-@croneUnderstandingAdolescencePeriod2012] posited that the developmental 
asymmetry between `r keyw("motivational")` and inhibitory `r keyw("brain")` circuits gives rise to a
"maturity gap" in middle adolescence. 
What distinguishes Crone and Dahl from related writings [e.g., @craccoEmotionRegulationChildhood2017]
is the emphasis on adolescents' diverging destinies;
why some youngsters flourish while others languish.
They argue that adolescents' cognitive engagement is dynamically responsive to
social and motivational `r keyw("goal salience")`.
This flexibility <!--, on the one hand,-->
prepares adolescents to <!--effectively engage cognitive systems in novel
challenging situations in a way that facilitates--> develop mature regulatory
abilities, but also places them at risk of impulsivity in
pursuit of `r keyw("peer approval")`. In terms of explanans,
this theory focuses primarily on cognitive factors
and the role of peers, with less attention to factors such as parenting.
This theory is relevant because it focuses on adolescence specifically,
but only tangentially addresses emotion regulation.

Other theories emphasize socialization to a greater extent,
such as Morris' tripartite model, which focuses on `r keyw("parents")`'
role in emotion regulation development [-@morrisRoleFamilyContext2007].
It describes three pathways through which parents shape emotion regulation
development: `r keyw("modeling")`, `r keyw("parenting practices")`, and the
emotional `r keyw("family climate")`,
which subsumes attachment and `r keyw("marital relationship")` quality.
Morris emphasizes the relevance of `r keyw("mothers")`, 
`r keyw("fathers")`, and siblings.
Others have adapted the tripartite model to describe peers' role in emotion regulation socialization
[@reindlSocializationEmotionRegulation2016].
A more abstract take on socialization is found in @holodynskiDevelopmentEmotionsEmotion2006's
internalization model of emotional development. 
Hallmarks of this theory are the interplay between emotion and `r keyw("communication")`,
and the internalization of the `r keyw("cultural")` symbolic function of emotion.
Several theories thus explain emotion regulation socialization in detail,
but a potential limitation is that they are not embedded in a larger unifying framework.
<!--Like Sroufe, Holodynski describes an age graded transition from
interpersonal to intrapersonal emotion regulation.
In doing so, Holodynski applies Vygotsky's theory of development to the domain of
emotion, and presents a detailed integrated model of emotional experience and
regulation.-->

Theories of the phenomenon of emotion regulation offer insight into
intra-individual drivers of emotion regulation development.
Gross' [-@grossHandbookEmotionRegulation2013] influential process model describes the
phenomenon of emotion regulation, from eliciting cue to ultimate response.
According to Gross, individuals use `r keyw("strategies")` to modulate the different stages of this process,
consciously or otherwise. The effectiveness, desireability, and consequences of some strategies vary across `r keyw("culture")`s [see
@bariolaChildAdolescentEmotion2011].
Similar to Gross' theory, the "social
information processing" theory also describes the role of cognitive
processes and strategies in emotion regulation
[@lemeriseIntegratedModelEmotion2000].
One limitation of these theories in the present context is the lack of a developmental component.

Finally, given our interest in risk factors that render adolescents susceptible
to emotional difficulties, we should mention two theories widely invoked to frame research on developmental influences: Bronfenbrenner's bioecological model, and Sameroff's
transactional model.
Bronfenbrenner [-@bronfenbrennerBioecologicalModelHuman2007] describes how the `r keyw("environment")`
shapes individual development.
Each individual is imbued with `r keyw("biological")` predispositions,
and develops in interaction with contextual influences.
These influences range from the microsystem,
composed of people close to the individual,
to the macrosystem, consisting of `r keyw("political")` and `r keyw("economic")` influences,
to the exosystem, consisting of `r keyw("cultural")` norms and `r keyw("values")`.
Sameroff's model [-@sameroffUnifiedTheoryDevelopment2010] is compatible with Bronfenbrenner's work,
but focuses more on the interplay between nature and nurture.
It conceptualizes development as a product of reciprocal influences between child and environment.
Sameroff distinguishes proximal influences such as parents (the microsystem in Bronfenbrenner's model)
from distal influences;
structural factors indirectly shaping development, like `r keyw("socio-economic status")`,
`r keyw("schools")`, and the `r keyw("community")` (macro- and exosystem).
With increasing age, distal influences gain ground on proximal influences.
These theories are broad enough to contextualize any developmental study,
but lack specificity, which curtails their utility in generating hypotheses.
<!-- RK: What do you take from these broad perspectives for your RQ?-->
<!--SH I am not sure what contribution this paragraph ultimately makes - you should consider condensing it substantially to just note that these theories have something to say about emotional development but are not adolescent-specific-->
<!--Theories like this are particularly relevant to a fine-grained
understanding of the process of emotion regulation, but their developmental
relevance has unfortunately not yet been considered (REF Buss). -->
<!--Parents are widely considered to be the primary proximal influence driving
emotion regulation development.
Yet several limitations remain.
@coe-odessEmergentEmotionsAdolescence2019;
instead takes an inductive approach to map the correlates of adolescents'
emotion regulation based on all available literature.

The present study instead takes an inductive approach to map the correlates of
adolescents' emotion regulation based on all available literature. From this
mapping, we proceed to classify correlates as potential risk factors,
manifestations, and outcomes of adolescent emotion regulation. The results
provide a conceptual overview of the existing literature, can help identify
blind spots in existing theory, and might inspire new hypotheses to guide
future deductive research.

Several limitations emerge from prior efforts to provide an encompassing
framework of this literature

These efforts at unification have, thusfar, been conducted in a top-down,
theory-driven manner.

which motivates most youngsters to seek out challenges in life and love, but
renders some of them vulnerable to emotion dysregulation.  -->

<!--
Note that the left panel of Figure \@ref(fig:baseline) visually summarizes the correlates of emotion regulation difficulties (labeled: *Dysregulation*) according to our theoretical review.
The left panel of Figure \@ref(fig:baseline) summarizes key constructs covered by the theories reviewed above. 
In the subsequent text mining analysis, we will distinguish the topics covered in this theoretical review visually to highlight unique contributions of our approach.
This allows us to see in what respects the text mining analysis reflects existing theory,
and in what respects it complements it.-->

### Shortcomings of existing theory

Despite the abundance of theory *relevant* to emotion regulation in adolescence,
the literature has several limitations.
First, few theories have explicitly addressed adolescence.
This life stage differs qualitatively from both childhood and adulthood [@bariolaChildAdolescentEmotion2011].
It is therefore questionable whether theories focused on different age groups can be generalized to adolescents.
<!--Relatedly, many relevant theories lack an explicit developmental component, which renders them and thus lack a well-substantiated
understanding of developmental processes[see
@bussTheoriesEmotionalDevelopment2019;
@croneUnderstandingAdolescencePeriod2012]. -->
Furthermore, few theories have comprehensively addressed important predictors of development in this life stage,
and none directly guide contemporary research in the field [see @bussTheoriesEmotionalDevelopment2019; @riedigerEmotionRegulationAdolescence2014].
Finally, existing theories vary widely in scope:
Some are broad and non-specific; others describe a specific phenomenon in detail,
but lack a broader perspective.
It would be beneficial to bridge these levels of analysis.
In sum, there is a need for more integrative theory formation,
in order to provide a unified framework that could guide future empirical work.<!--[see @riedigerEmotionRegulationAdolescence2014].
Inductive analysis of the empirical literature may constitute a first step to this end.-->
<!--Such a theory should focus on -->
The present study lays the groundwork for such theory development,
by providing a text-mining based inductive systematic review of the field.

<!--
Barriola: What is most
* evident from the reviewed studies is that the samples
investigated have been mainly non-clinical, within the
early childhood period of development and have examined
predominantly maternal socialization factors.
* the vast
majority have been restricted to toddlers and young chil-
dren and have only examined the in?uence of maternal,
and not paternal, expression.
Most of the literature has addressed emotion regulation in adult or infant
samples. A smaller, but substantial, portion of the literature has examined
emotion regulation in adolescents.
-->

<!-- Next paper: * Existing theory is not very specific, in the sense that it
can give rise to concrete, testable predictions. "either is not guided by
hypotheses of an explicit theory or cites a theory but does not explicitly test
the theory." (Buss) (Smaldino)-->
<!--Unfortunately, there is little theory about which risk factors and
environmental hazards render adolescents susceptible to emotional
difficulties11-->

<!--Initially, much of the research on emotion regulation focused on either
adulthood or early childhood. In recent years, however, a substantial body of
research on emotion regulation in adolescence has accrued.-->

<!--What are the predictors of emotion regulation in adolescence?-->

<!--Emotion regulation can be defined as the ability to modulate emotional
experience and expression through automatic or deliberate processes. -->


<!--


## Why focus on theory?


A focus on theory is becoming increasingly important, given the concern about
the replicability of social scientific findings [@KLEIN].

Several authors of comprehensive reviews have noted that developmental theories
of emotion are still in their infancy [@bussTheoriesEmotionalDevelopment2019].
Several specific limitations of the theoretical landscapes precipitate the
present study. First, although there are many *relevant* theories, few are
focused specifically on emotion regulation. Second, the stage of adolescence is
rarely addressed, although empirical research has indicated that this is a
crucial period of emotion regulation development.
"emotion theory has largely focused on adults, and emotional development theory
has largely focused on infancy and early childhood (see Chap. 24 on adolescent
emotional development)." Buss et al 2019:20

## Why inductive -->

## Prior narrative reviews

Whereas theory provides a top-down frame of reference,
literature reviews can provide a bottom-up, inductive understanding of a phenomenon.
Given the noted absence of a single overarching theory, reviews might provide additional
insight into factors considered relevant in the etiology of adolescents'
emotion regulation competencies. 
Innovative text mining methods are promising in this respect, because they can comprehensively review the available literature.
Narrative reviews, however, constitute the status quo.
We will therefore examine how two excellent narrative reviews on emotion regulation in adolescence complement the aforementioned theoretical literature [@coe-odessEmergentEmotionsAdolescence2019; @bariolaChildAdolescentEmotion2011].
Figure \@ref(fig:baseline) visualizes constructs uniquely covered by these narrative reviews,
relative to the theoretical literature.

<!--
Note that the left panel of Figure \@ref(fig:baseline) visually summarizes the correlates of emotion regulation difficulties (labeled: *Dysregulation*) according to our theoretical review.
The left panel of Figure \@ref(fig:baseline) summarizes key constructs covered by the theories reviewed above. 
In the subsequent text mining analysis, we will distinguish the topics covered in this theoretical review visually to highlight unique contributions of our approach.
This allows us to see in what respects the text mining analysis reflects existing theory,
and in what respects it complements it.-->

A seminal review by
@bariolaChildAdolescentEmotion2011 addressed intra-individual factors
such as temperament, and biological factors like neurocognitive development and
genes.
Proximal social influences covered include socialization and modeling by parents, teachers, and peers.
Finally, distal factors include the role of culture and the
media.
Barriola and colleagues made several suggestions for future research,
calling for a robust theoretical framework to guide future
research, for research on parents' role beyond early childhood,
and for additional work on the role of fathers in emotion socialization.
The latter two topics are now receiving more attention [e.g., see @vanlissaRoleFathersMothers2019;
@vanlissaMothersFathersQuantitative2020].

A recent review by @coe-odessEmergentEmotionsAdolescence2019 offers a nuanced
discussion of several issues that complement prior publications.
This includes the implications of physiological changes,
including neurocognitive development and pubertal maturation.
Conflict with parents is addressed too, which peaks when adolescents become increasingly individuated.
Such conflict impacts both day-to-day mood swings and dispositional emotion dysregulation [see also
@vanlissaCostEmpathyParentadolescent2017].
Adolescents also become increasingly oriented towards peers.
This increases sensitivity to social status and norms,
along with concomitant increases in peer pressure and risk taking.
Pubertal development further precipitates sexual and romantic behavior,
and the intensification of both biological sex differences and gender stereotyped behavior.
<!--With regard to the process of emotion regulation,
Coe-Odess and colleagues discuss the importance
of strategies, and point out that, in addition to negative emotionality,
positive emotionality also peaks in adolescence. -->
Relatedly, the authors describe how hormonal changes intensify the stress response,
which helps explain adolescents' greater susceptibility to emotion dysregulation.
Finally, <!--going beyond the implications of cognitive development
discussed in other publications,--> the authors discuss how cognitive development and increased capacity
for abstract thought relate to identity formation - a key challenge in
adolescence [@meeusStudyAdolescentIdentity2011] - and to increased emotional
understanding, and by extension, empathy [see also
@vanlissaLongitudinalInterplayAffective2014].

As can be seen in Figure \@ref(fig:baseline), 
there are notable parallels between correlates of emotion regulation identified in these
narrative reviews, and in the preceding theoretical literature.
Nevertheless,
these literature reviews also touch upon issues that have received little
attention in theoretical work.
<!--These include specific individual differences at the biological and psychological level, including genetic predisposition, hormones, pubertal onset, gender, sexuality, temperament, identity, empathy, and stress.
Further introduced are proximal influences, including the role of media, norms, and social status.-->
This illustrates that reviews of the empirical literature can contribute additional insight into key factors in adolescents' emotion regulation development.
An important limitation is that all reviews in this field have been unstructured narrative reviews, which are known to be limited in scope and biased [@littellEvidencebasedBiasedQuality2008].
We seek to complement preceding work by using text mining to conduct a more comprehensive empirical
literature review, and map the factors associated with adolescent emotion
regulation.

<!-- NIET TEVEEL OVER THEORIE PRATEN; IK KIJK NIET NAAR THEORIE. IK KIJK NAAR FACTOREN DIE IN VERBAND GEBRACHT WORDEN MET EMOTIEREGULATIE. -->
<!--The life stage of adolescence differs qualitatively from both childhood and adulthood. It is therefore not sufficient to extend -->

<!--
Influences on emotion regulation (Riediger Klipker)
* Neurophysiological development 
* Familial context



Despite widespread interest in emotion regulation in adolescence, there is a lack of explicit theories about which risk factors and environmental hazards render adolescents susceptible to emotional difficulties. Some theories can be considered relevant, but these theories are rarely explicit enough to generate specific predictions. 
As many as one in five adolescents experiences severe emotional problems. A key question is therefore which factors render adolescents at-risk for difficulties in emotion regulation. 

Unfortunately, relevant theory on adolescent emotion regulation development is limited27–29. The field is therefore at an impasse: We know that some adolescents are more susceptible to emotion dysregulation than others, but lack tools and theory to identify important predictors of individual development30.

inductive approach, thereby facilitating a more complete understanding of developmental processes, and nourishing theory formation

My work addresses this lacuna by taking an inductive approach to theory formation; paying special attention to between-person differences. This paves the way for a new wave of person-centered research


Key questions:

Why focus on emotion regulation specifically, instead of other aspects of emotional development?

* Biological determinants
* Social determinants

* Existing developmental theories do not focus on adolescence (rather, on adults, or development in infancy and childhood). However, many interesting emotion-related things happen in adolescence.

Important:
Buss: theories of emotion and emotional development
Cracco: Evidence for a maladaptive shift in emotion regulation in adolescence
Zimmermann & Iwanski: Dip in adolescence

Sroufe 1995: Development of emotion regulation until preschool age
"the key progression in emotional regulation is from caregiver-orchestrated
regulation to dyadic regulation to self-regulation."
* attachment - dyadic regulation of emotion (Sroufe 1996)
* Caregiver-guided self-regulation 
* Autonomous self-regulation
***** HOWEVER: In adolescence, regulatory brain regions still developing!!!! So Sroufe stops too early

Polyvagal theory Porges 1995 -->

<!-- SH: ultimately I think that the introduction is too long - considering that the introduction, itself, is a literature review to some extent, I don't come away with a clear delineation between the literature review up this point and the new work you are going to contribute. I think you need to review the Introduction with an eye on focusing the discussion on the problems/gaps that exist and how the lit review method usually used are insufficient for addressing those issues-->

## The present paper

The present paper aims to map the constructs
related to adolescent emotion dysregulation, based on a systematic review of
the literature. <!-- CJ Consider removing the following if the purpose is sufficiently clarified in the introduction -->
First, we conducted a systematic search to
elicit a corpus of relevant literature. Second, we used text mining techniques
to extract relevant constructs from the corpus. Third, we used a dictionary to
pare down the extracted constructs to meaningful superordinate categories.
Fourth, we mapped interrelations between these constructs. Fifth, we classified
contstructs as potential predictors or outcomes.
We used the Workflow for Open Reproducible Code in Science (WORCS)
to ensure transparency and  reproducibility. All code and data are available online at [masked]. 

# Methods

## Search strategy

We searched Web of Science,
the most comprehensive database for which we had permissions to export keywords and abstracts.
The search strategy was based on
procedures described by Staaks [@staaksSystematicReviewSearch]. First, we
constructed a reference set of 29 articles.
Then we constructed a search string to retrieve this set.
The search string consisted of synonyms of emotion regulation and adolescence.
It returned 6653 results, including 25 records in the reference set.
To match all 29 reference set items required adding the terms `"emotio* socialization" OR "emotio* processes"` as synonyms for emotion regulation.
Doing so resulted in 191 more hits, most of which did not meet the inclusion criteria explained below.
We thus deemed these terms to be overly inclusive, and
proceeded with the original search string above.
```{r readrecs}
filenam <- "recs_6653.RData"
if(!file.exists(filenam)){
  library(bibliometrix)
  f <- list.files("./recs/18-3-2020/", full.names = TRUE)
  f <- readFiles(f)
  recs <- convert2df(f)
  saveRDS(recs, filenam)
} else {
  recs <- readRDS(filenam)
}
```

```{r removeduplicates}
filenam <- "unique_recs.RData"
if(!file.exists(filenam)){
  library(revtools)
  recs$doi <- recs$DI
  recs$doi[is.na(recs$doi)] <- paste0("fake", 1:sum(is.na(recs$doi)))
  if(any(duplicated(recs$doi))){
    recs$doi[duplicated(recs$doi)|duplicated(recs$doi, fromLast = T)]
    dup_doi <- duplicated(recs$doi)
    recs <- recs[!dup_doi, ]
  }
  recs$title <- recs$TI
  # locate and extract unique references
  potential_dups <- find_duplicates(recs, match_variable = "title", match_function = "stringdist", threshold = 5, to_lower = TRUE, remove_punctuation = TRUE)
  unique_recs <- extract_unique_references(recs, matches = potential_dups)
  saveRDS(unique_recs, filenam)
  write.csv(data.frame(dup_doi = sum(dup_doi), dup_title = (nrow(recs)-nrow(unique_recs))-sum(dup_doi)), "dups.csv", row.names = FALSE)
} else {
  unique_recs <- readRDS(filenam)
  dups <- read.csv("dups.csv")
}
unique_recs$id_num <- 1:nrow(unique_recs)

if(FALSE){
  # df_screen <- unique_recs[, c("id_num", "TI", "AB")]
  # names(df_screen) <- c("id_num", "title", "abstract")
  # write.csv(df_screen, file = "asreview.csv", row.names = FALSE, fileEncoding = "UTF-8")
  df_screen <- unique_recs[, c("id_num", "TI", "AU", "SO", "SN", "VL", "IS", "BP", "PY", "PU", "DI", "AB")]
  names(df_screen) <- c("key", "title", "authors", "journal", "issn", "volume", "issue", "pages", "year", "publisher", "url", "abstract")
  write.csv(df_screen, file = "rayyan.csv", row.names = FALSE)
}
rayyan_res <- read.csv("rayyan_exports/articles.csv")
rayyan_dups <- nrow(unique_recs) - nrow(rayyan_res)

```

## Screening

```{r, message=FALSE}
screen <- read.csv("asreview_result_sysrevemotprob.csv")
screen <- screen[screen$key %in% rayyan_res$key, ]
screen$drop_these <- FALSE
screen$drop_these[which(screen$included == 1 | screen$rayyan == "False")] <- TRUE

if(!file.exists("recs_final.csv")){
  recs_final <- unique_recs[screen$key[!screen$drop_these], ]
  write.csv(recs_final, "recs_final.csv", row.names = FALSE)
} else {
  recs_final <- read.csv("recs_final.csv")
}
```
The screening and deduplication procedure is detailed in Figure \@ref(fig:prismachart).
Duplicates were identified using DOI and title similarity.
Papers were screened based on two main criteria:
They had to address emotion regulation or a synonymous construct, and the target population must overlap with the age range of adolescence (10-24).
Preliminary screening was conducted in Rayyan QRCI [@Ouzzani2016].
After coding `r sum(screen$rayyan == "True")+sum(screen$rayyan == "False")` papers, screening continued in ASReview [@van_de_schoot_rens_2020_3828293].
This program uses machine learning to screen articles.
We trained the machine learning algorithm by manually screening an additional `r sum(table(screen$included, screen$rayyan)[, 1])` papers, until - among the most recently screened 100 papers - only 6 were excluded.
In total, `r nrow(recs_final)` papers were deemed suitable for analysis.

```{r prismachart, results='asis', fig.cap="Record screening flowchart"}
if(!isTRUE(tools::md5sum("prismachart.png") == "08351426aee2005edd1332a32b958ea0" )){
  library(tidySEM)
  
  lo <- matrix(c("start", "dedup", "rayyan", "asreview", "included",
                 "", "dedup2", "excluded", "", ""), nrow = 5, ncol = 2)
  
  nodes <- data.frame(
    name = c("start", "dedup", "dedup2", "rayyan", "asreview", "included", "excluded"), 
    label = c(
      paste0("Records identified through\nWeb of Science (n = ", nrow(recs), ")"), 
      paste0("After duplicates removed\n(n = ", nrow(unique_recs), ")"), 
      paste0("Duplicates\n(n = ", nrow(recs)-nrow(screen), ")"), 
      paste0("Articles screened for eligibility\nusing Rayyan (n = ", nrow(screen), ")"), 
      paste0("Articles screened for eligibility\nusing ASReview (n = ", nrow(screen), ")"), 
      paste0("Studies included in\nqualitative synthesis (n = ", nrow(recs_final), ")"),
      paste0("Excluded studies (n = ", nrow(screen)-nrow(recs_final), ")"))
  )
  
  edges <- data.frame(
    from = c("start", "dedup", "rayyan", "asreview",
             "start", "rayyan", "rayyan", "asreview"),
    to = c("dedup", "rayyan", "asreview", "included",
           "dedup2", "dedup2", "excluded", "excluded"),
    label = c("",   "", paste0("n = ", sum(screen$rayyan == "True")), paste0("n = ", sum(screen$included == 0, na.rm = TRUE)-sum(screen$rayyan == "True")),
              paste0("n = ", sum(dups)), 
              paste0("n = ", rayyan_dups),
              paste0("n = ", sum(screen$rayyan == "False")),
              paste0("n = ", sum(screen$included == 1, na.rm = TRUE)-sum(screen$rayyan == "False"))
    )
  )
  
  p <- graph_sem(layout = lo, nodes = nodes, edges = edges, angle = 1, rect_height = 1.2, rect_width = 1.3, text_size = 4)
  ggsave("prismachart.png", p, device = "png")
  ggsave("prismachart.svg", p, device = "svg")
}

knitr::include_graphics("prismachart.png")
```

<!--
## Corpus description


{r, eval = FALSE}
# Plot papers per year
df_plot <- as.data.frame(table(recs_final$PY), stringsAsFactors = FALSE)
df_plot$Year = as.numeric(df_plot$Var1)
ggplot(df_plot, aes(x= Year, y= Freq))+geom_point() + geom_path(group =1)+
  theme_bw() + scale_y_log10()
-->

# Analysis 1: Author keyword mapping

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(stringr)
library(udpipe)
library(igraph)
library(wordcloud)
library(Matrix)
library(ggplot2)
library(yaml)
source("word_functions.R")
source("circle2.R")

#run_everything = FALSE
study1details <- read_yaml("study1_details.yml")
dict <- read_yaml("yaml_dict.txt")
## Look at POS tags?
if(!isTRUE(tools::md5sum("study1_df.RData") == "042c7d894929b0351f804c1a4b5c5002")){
  recs <- data.table(read.csv("recs_final.csv"))
  if(!is.data.table(recs)){
    browser()
  }
  recs[, "doc" := 1:nrow(recs)]
  study1details <- list(dim_recs = dim(recs))
  
  # Extract individual words
  df <- lapply(recs$DE, function(x){strsplit(x, split = "; ")[[1]]})
  df <- merge_df(recs, df, "word")
  
  df[, word := tolower(word)]
  
  # Clean
  df <- na.omit(df, cols = "word")
  number_docs_words <- c(docs = length(unique(df$doc)), words = length(unique(df$word)))
  yaml::write_yaml(number_docs_words, "study1_number_docs_words.txt")
  # Exclude words
  exclude_terms <- readLines("exclude_terms.txt")
  exclude_these <- unique(unlist(lapply(exclude_terms, grep, x = df$word)))
  
  df <- df[!exclude_these, ]
  
  # Categorize words
  res_cat <- cat_words(df$word, dict, handle_dups = "all")
  # Check coding issues
  #res_cat$dup
  #head(res_cat$unmatched)
  df <- merge_df(df, res_cat$words, "word_coded")
  saveRDS(df, "study1_df.RData")
} else {
  df <- readRDS("study1_df.RData")
  number_docs_words <- yaml::read_yaml("study1_number_docs_words.txt")
}


if(run_everything){
  # Frequency of word by doc
  nounbydoc <- df[, list(freq = .N), by = list(doc_id = doc, term = word_coded)]
  # Set frequency to 1; we're not interpreting word frequency, only occurrence
  nounbydoc$freq <- 1
  
  dtm <- udpipe::document_term_matrix(document_term_frequencies(nounbydoc))
 
  # Continue plotting word frequency ----------------------------------------
  
 
  
  set.seed(5348)
  dtm_top <- dtm[, select_words(dtm, .975)]
  dtm_top <- dtm_top[rowSums(dtm_top) > 0, ]
  write_yaml(dim(dtm_top), "study1_dtm_top.yml")
  
  # Wordcloud ---------------------------------------------------------------
  
  ## Word frequencies
  topterms <- colSums(dtm_top)
  baseline <- readRDS("baseline.RData")
  
  word_freq <- data.frame(Word = names(topterms), Frequency = topterms, row.names = NULL)
  write.csv(word_freq, "study1_word_freq.csv", row.names = FALSE)
  df_plot <- word_freq
  df_plot <- df_plot[order(df_plot$Frequency, decreasing = TRUE), ]
  categ <- read.csv("study1_categorization.csv", stringsAsFactors = FALSE)
  df_plot$cat <- categ$category[match(df_plot$Word, categ$name)]
  df_plot$baseline <- as.character(df_plot$Word %in% baseline)
  df_plot$faded <- df_plot$Word %in% baseline
  # Tag words that are not in the cooccurrence graph
  in_graph <- row.names(read.csv("s1_cooc.csv", row.names = 1))
  notingraph <- !df_plot$Word %in% in_graph
  italic_labels <- as.character(df_plot$Word)
  italic_labels[notingraph] <- sapply(italic_labels[notingraph], function(x){
    parse(text = paste0("italic('", x, "')"))
  })
  # Prettify words
  df_plot$Word <- pretty_words(df_plot$Word)
  
  
  
  df_plot$Word <- ordered(df_plot$Word, levels = df_plot$Word[order(df_plot$Frequency)])
  
  
  cat_cols <- c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "forestgreen")
  df_plot$cat <- ordered(df_plot$cat, levels = c("Outcome", "Indicator", "Cause", "Protective"))
  
  write_yaml(df_plot$Word, "s1_words.yml")
  
  p <- ggplot(df_plot, aes(y = Word, x = Frequency)) +
    geom_segment(aes(x = 0, xend = Frequency,
                     y = Word, yend = Word, linetype = notingraph), colour = "grey50"
    ) + 
    geom_vline(xintercept = 0, colour = "grey50", linetype = 1) + xlab("Word frequency") +
    geom_point(data = df_plot[df_plot$faded, ], aes(colour = cat), fill = "white", shape = 21, size = 1.5) +
    geom_point(data = df_plot[!df_plot$faded, ], aes(colour = cat, fill = cat), shape = 21, size = 1.5) +
    scale_colour_manual(values = c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "forestgreen"), guide = NULL)+
    scale_fill_manual(values = c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "forestgreen")) +
    scale_x_log10() +
    #scale_y_discrete(labels = italic_labels) +
    scale_linetype_manual(values = c("TRUE" = 3, "FALSE" = 1), guide = NULL) +
    theme_bw() + theme(panel.grid.major.x = element_blank(),
                       panel.grid.minor.x = element_blank(), axis.title.y = element_blank(),
                       legend.position = c(.70,.125),
                       legend.title = element_blank(),
                       axis.text.y = element_text(hjust=0, vjust = 0, size = 6))
  
  svg("s1_varimp.svg", width = 7/2.54, height = 14/2.54)
  eval(p)
  dev.off()
  
  ggsave("s1_varimp.png", p, device = "png", width = 7, height = 14, units = "cm")
  
  df_plot$Frequency <- sqrt(df_plot$Frequency)
  ## Visualise them with wordclouds
  p <- quote({
    set.seed(46)
    wordcloud(words = df_plot$Word, freq = df_plot$Frequency, scale = c(2,.4), max.words = 150, rot.per = 0,  random.order = FALSE, colors = brewer.pal(8, "Dark2"))
  })
  svg("study1_wordcloud.svg")
  eval(p)
  dev.off()
  
  png("study1_wordcloud.png")
  eval(p)
  dev.off()
}


# LDA analysis ------------------------------------------------------------

if(!isTRUE(tools::md5sum("Study1_lda_dims.txt") == "4e2493d4d618020d4acde61dd7864425")){
  library(Rmpfr)
  library(topicmodels)
  library(udpipe)
  library(slam)
  library(tidytext)
  # Functions:
  harmonicMean <- function(logLikelihoods, precision = 2000L) {
    llMed <- median(logLikelihoods)
    as.double(llMed - log(mean(exp(-mpfr(logLikelihoods,
                                         prec = precision) + llMed))))
  }
  BIC <- function(ll, p, n){
    -2 * ll + p * log(n)
  }
  entropy <- function(post_prob){
    1 + (1/(nrow(post_prob) * 
              log(ncol(post_prob)))) * (sum(rowSums(post_prob * 
                                                      log(post_prob + 1e-12))))
  }
  
  # Preprocessing -----------------------------------------------------------
  
  #nounbydoc <- df[, list(freq = .N), by = list(doc_id = doc, term = word_coded)]
  df_lda <- nounbydoc #[nounbydoc$term %in% names(dict), ]
  df_lda <- df_lda %>%
    bind_tf_idf(term, doc_id, freq)
  summary(df_lda$tf_idf)
  df_lda <- df_lda[order(df_lda$tf_idf),]
  
  select_words <- df_lda[!duplicated(df_lda$term), ]
  select_words <- select_words$term[select_words$tf_idf >= median(select_words$tf_idf)]
  df_lda <- df_lda[df_lda$term %in% select_words, ]
  
  dtm <- udpipe::document_term_matrix(document_term_frequencies(df_lda))
  
  # dtm <- as.simple_triplet_matrix(dtm)
  # dim(dtm)
  # summary(col_sums(dtm))
  # term_tfidf <- tapply(dtm$v/row_sums(dtm)[dtm$i], dtm$j, mean) * log2(dim(dtm)[1]/col_sums(dtm > 0))
  # summary(term_tfidf)
  
  yaml::write_yaml(dim(dtm), file = "Study1_lda_dims.txt")
  
  # Build topic models
  
  seqk <- seq(2, 20, 1)
  burnin <- 1000
  iter <- 1000
  keep <- 50
  set.seed(44773)
  res_lda <- lapply(seqk, function(k) {
    topicmodels::LDA(
      dtm,
      k = k,
      method = "Gibbs",
      control = list(
        burnin = burnin,
        iter = iter,
        keep = keep
      )
    )
  })
  
  ll <- sapply(res_lda, function(x){harmonicMean(x@logLiks[-c(1:(burnin/keep))])})
  
  K = seqk
  N = nrow(dtm)
  M = ncol(dtm)
  
  parameters <- K*(M-1)+N*(K-1)
  N <- nrow(dtm)
  bics <- BIC(ll, parameters, N)
  
  entropies <- sapply(res_lda, function(x){entropy(x@gamma)})
  
  p <- ggplot(data.frame(K = seqk, Entropy = entropies), aes(x = K, y = Entropy)) + geom_path() +
    xlab('Number of topics') +
    scale_y_continuous(limits = c(0,1)) +
    theme_bw()
  
  ggsave("study1_entropies.png", p, device = "png")
  ggsave("study1_entropies.svg", p, device = "svg")
  
  p <- ggplot(data.frame(K = seqk, ll = ll), aes(x = K, y = ll)) + geom_path() +
    geom_vline(xintercept = (which.max(ll)+1), linetype = 2) +
    xlab('Number of topics') +
    geom_smooth(method = "lm", formula = y~log(x), se = FALSE)+
    theme_bw()
  
  ggsave("study1_ll.png", p, device = "png")
  ggsave("study1_ll.svg", p, device = "svg")
  
  p <- ggplot(data.frame(K = seqk, BIC = bics), aes(x = K, y = BIC)) + geom_path() +
    geom_vline(xintercept = (which.min(bics)+1), linetype = 2) +
    xlab('Number of topics') +
    geom_smooth(method = "lm", formula = y~x, se = FALSE)+
    theme_bw()
  
  ggsave("study1_BIC.png", p, device = "png")
  ggsave("study1_BIC.svg", p, device = "svg")
}

# Co-occurrence -----------------------------------------------------------

if(run_everything){
  set.seed(52)
  cooc <- select_cooc(create_cooc(dtm_top), q = .975)
  write.csv(as.matrix(cooc), "s1_cooc.csv")
  df_plot <- as_cooccurrence(cooc)
  df_plot <- df_plot[!df_plot$term1 == df_plot$term2, ]
  df_plot <- df_plot[order(df_plot$cooc, decreasing = TRUE), ]
  
  df_plot$id <- apply(df_plot[, c("term1", "term2")], 1, function(x)paste0(sort(x), collapse = ""))
  df_plot <- df_plot[!duplicated(df_plot$id), ]
  
  # Write study details -----------------------------------------------------
  
  write_yaml(study1details, "study1_details.yml")
  
  
  # Create network ----------------------------------------------------------
  
  edg <- df_plot
  edg$width = edg$cooc
  
  vert <- data.frame(name = names(topterms), label = pretty_words(names(topterms)), size = topterms)
  vert <- vert[vert$name %in% unique(c(edg$term1, edg$term2)), ]
  
  categ <- read.csv("study1_categorization.csv", stringsAsFactors = FALSE)
  if(any(!vert$name %in% categ$name)){
    write.table(vert$name[!vert$name %in% categ$name], "clipboard", sep = "\n", row.names = FALSE, col.names= FALSE)
    stop("Please re-categorize missing vertices.")
  } 
  vert$Category <- categ$category[match(vert$name, categ$name)]
  vert$faded <- vert$name %in% baseline
  
  cat_cols <- c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "olivedrab2")
  vert$color <- cat_cols[vert$Category]
  vert$frame.color <- cat_cols[vert$Category]
  vert$color[vert$faded] <- "#FFFFFF"
  
  vert$size <- scales::rescale(log(vert$size), c(4, 12))
  g <- graph_from_data_frame(edg, vertices = vert,
                             directed = FALSE)
  
  # edge thickness
  E(g)$width <- scales::rescale(sqrt(E(g)$width), to = c(2, 8))
  
  
  dysreg_vertex = which(names(V(g)) == "dysregulation")
  
  edge.start <- ends(g, es=E(g), names = FALSE)[,1]
  edge.end <- ends(g, es=E(g), names = FALSE)[,2]
  E(g)$lty <- c(1, 5)[(!(edge.start == dysreg_vertex|edge.end == dysreg_vertex))+1]
  
  # Layout
  set.seed(6) #4
  l1 <- l <- layout_with_fr(g)
  l1[,1] <- -1*l1[,1]
  set.seed(64)
  l2 <- layout_in_circle(g, order = shifter(V(g), -3))
  
  p <- quote({
    # Set margins to 0
    par(mar=c(0,0,0,0),
        mfrow=c(1,2))
    plot(g, edge.curved = 0, layout=l1,
         vertex.label.family = "sans",
         vertex.label.cex = 0.8,
         vertex.shape = "circle2",
         #vertex.frame.color = 'gray40',
         vertex.label.color = 'black',      # Color of node names
         vertex.label.font = 1,         # Font of node names
         vertex.frame.width = 2
    )
    legend(x=-1.1, y=1.1, names(cat_cols), pch=21, col="#777777", pt.bg=cat_cols, pt.cex=2, cex=.8, bty="n", ncol=1)
    plot(g, edge.curved = 0, layout=l2,
         vertex.label.family = "sans",
         vertex.label.cex = 0.8,
         vertex.shape = "circle2",
         #vertex.frame.color = 'gray40',
         vertex.label.color = 'black',      # Color of node names
         vertex.label.font = 1,         # Font of node names
         vertex.frame.width = 2
    )
  })
  
  # Save files
  png("study1_network1.png", width = 960)
  eval(p)
  dev.off()
  
  svg("study1_network1.svg", width = 14)
  eval(p)
  dev.off()
}
categ <- read.csv("study1_categorization.csv", stringsAsFactors = FALSE)
word_freq <- read.csv("study1_word_freq.csv", stringsAsFactors = FALSE)
word_graph <- read.csv("s1_cooc.csv", row.names = 1)
notingraph <- word_freq$Word[!word_freq$Word %in% row.names(word_graph)]
notingraph <- categ[categ$name %in% notingraph, ]
cats <- unique(notingraph$category)
notingraph <- lapply(cats, function(x){ 
  out <- notingraph$name[notingraph$category == x]
  out <- pretty_words(out)
  paste0(paste0("*", out[-length(out)], "*", collapse = ", "), ", and *", tail(out, 1), "*")
  })
names(notingraph) <- cats

lda_dims <- read_yaml("Study1_lda_dims.txt")
dtm_top <- read_yaml("study1_dtm_top.yml")
```

The corpus for this first analysis consisted of author-provided keywords.
We extracted keywords by document, and applied an exclusion filter of methodological terms and similar non-substantive words.
Then, we used a dictionary to classify related terms.
The dictionary describes `r length(dict)` terms using `r length(unlist(dict))`
regular expression queries.
The resulting term-document matrix consisted of `r number_docs_words[1]` documents with `r number_docs_words[2]` unique terms.

## Structural topic modeling

<!-- it might be useful to insert a sentence or two when you are using a method many readers are not familiar with, just to explain the utility of the chose method (what it does/doesn't do potentially as compared to other options)-->
One important step before reviewing the literature is to examine heterogeneity in the corpus;
for example, whether there is a clear divide between psychiatric and developmental texts.
To test for heterogeneity, we conducted topic modeling using latent dirichlet allocation [@bleiLatentDirichletAllocation2003].
This is a clustering method for large sparse matrices.
We used the term frequency/inverse document frequency (TF-IDF) to select terms
used frequently in a document, but not used frequently in the corpus,
which could therefore be more diagnostic of subgroup membership.
Selection terms with an TF-IDF greater than the median resulted in a corpus of `r lda_dims[1]` documents and `r lda_dims[2]` terms.
We considered a range from 2-20 topics, evaluating fit based on the BIC, and interpretability based on the entropy of the posterior document/topic probabilities.
The BICs followed a near-perfect linearly increasing trend, indicating that no subcorpora could be identified.
Congruently, all entropies were near-zero, which means that the posterior document/topic probabilities were effectively uniformly distributed.
Thus, no subcorpora could be identified,
and we proceed with an analysis of the whole sample. <!-- Probably because each set of keywords has only a few indicators. -->

## Identifying common terms

To identify what issues are covered in this corpus,
we examined the terms occurring in the largest number of texts.
We modeled word frequency using a negative binomial distribution,
and retained those exceeding the $97.5^{th}$ percentile.
This resulted in `r dtm_top[2]` terms, which occurred in `r dtm_top[1]` documents.
The issues covered in this body of literature are visualized in Figure \@ref(fig:study1varimp).

```{r study1varimp, warning=FALSE, eval = TRUE, results='asis', out.width = "100%", fig.cap="Document frequency of terms selected for Study 1. Transparent circles indicate constructs represented in theory (Figure 1), dotted lines indicate constructs absent from the co-occurrence graph."}
knitr::include_graphics("s1_varimp.png") 
#fig_svg <- cowplot::ggdraw()+cowplot::draw_image("s1_varimp.svg")
#plot(fig_svg)

```

## Mapping the literature

Next, we computed a term co-occurrence matrix,
which represents how frequently words occurred within the same document (see Figure \@ref(fig:study1network)).
To aid interpretability, we again pruned small coefficients using a negative binomial distribution,
retaining co-occurrences exceeding the $97.5^{th}$ percentile.
To stimulate further reflection on the role of each construct,
we manually classified each of the selected terms as either a putative 'Cause', 'Outcome', 'Protective factor', or 'Indicator' of emotion dysregulation.
We stress that this classification is subjective and acknowledge that many of these associations are likely to be bidirectional [e.g., emotion dysregulation is known to be both a cause and consequence of conflict with parents, @vanlissaCostEmpathyParentadolescent2017].

```{r study1network, warning=FALSE, out.width = "100%", fig.cap="Study 1 term co-occurrence. Two layouts are presented to aid interpretation. Size of lines and circles represents frequency. Dashed lines represent links not involving dysregulation. Transparent circles indicate constructs also represented in the theory (cf Figure 1)."}
#knitr::include_graphics("study1_network1.svg")
library(cowplot)
fig_svg <- cowplot::ggdraw()+cowplot::draw_image("study1_network1.svg")
plot(fig_svg)
```

## Results

Emotion dysregulation and its mental health-related outcomes were foremost among the common terms in the corpus (Figure \@ref(fig:study1varimp)). 
Other frequent terms reflect important themes discussed in the theoretical review of the literature;
for instance, the terms *neural*, *parenting*, and *stress* correspond to themes discussed by  @coe-odessEmergentEmotionsAdolescence2019:
Neurocognitive development, the role of the parents, and adolescents' increased stress response.
Importantly, the most common terms also include several concepts not featured prominently in the theoretical review.
For example, *ADHD/CD* [cf. @braetEmotionRegulationChildren2014], *substance* use [cf. @coe-odessEmergentEmotionsAdolescence2019; @pierrehumbertStrategiesEmotionRegulation2002], and *minority status* [cf. @myersEthnicitySocioeconomicStatusrelated2009; @myersEthnicitySocioeconomicStatusrelated2009] are common in the corpus,
but featured less prominently in the theoretical review.

Based on the co-occurrence graph (Figure \@ref(fig:study1network)),
emotion dysregulation is evidently a central construct
to which most other constructs are directly linked.
This suggests that our search successfully identified factors relevant for adolescents’ emotion dysregulation.
The remaining graph is notably sparse, with few interconnections between terms.

## Discussion

This first analysis used author keywords to map common topics in the literature pertaining to adolescents' emotion dysregulation.
The results reflected some of the constructs commonly accepted as relevant in theoretical literature and empirical reviews - particularly those pertaining to neurodevelopment and socialization.
The most frequently occurring words were classified as potential outcomes of emotion regulation difficulties, and revealed a theme related to mental health.
This validates the notion that adolescent emotion regulation is implicated in a range of mental health problems, which underlines the importance of this area of research.

In addition to the themes addressed in the theoretical Introduction,
several novel themes emerge from this analysis. 
Developmental disorders constitute such a theme, as ADHD/CD and autism are ranked highly.
Another theme is the role of physical health (sic), also reflected in terms like sleep, sports, and disability status.
External stressors are another important theme, reflected in bullying, stress, PTSD, abuse, violence, life events, historic events (e.g., earthquakes, war), and parenting stress.
Structural disadvantage is certainly a factor overlooked in existing theory,
and is reflected in minority status, disability status, socio-economic status, adoption status, sexual diversity, and the adorementioned developmental disorders, as neuroatypical individuals may also experience such disadvantage.
These insights illustrate how inductive reviews may complement existing theory and narrative reviews, and can reveal blindspots.<!-- SH: this point/advantage needs to feature more prominently in the introduction!-->

The co-occurrence graph revealed few connections among topics.
Many constructs were only linked with emotion regulation,
and there were relatively few interconnections between elements.
This observation substantiates the prior claim that this literature is somewhat fragmented [@bussTheoriesEmotionalDevelopment2019]. 
This sparse property of the network explains, in part,
why some of the most prevalent terms based on term document frequency
(see Figure \@ref(fig:study1varimp)) are absent from the co-occurrence graph.
These terms were not strongly related to any other terms in the main network. 
Amongst the terms culled from the co-occurrence graph are the potential causes `r notingraph["Cause"]`, the potential outcomes `r notingraph["Outcome"]`, and the potential protective factors `r notingraph["Protective"]`.

Many of these excluded constructs represent active ongoing areas of research, including research on *fathers* [@vanlissaRoleFathersMothers2019], *identity* [@campbellFriendsEducationIdentity2019], *friendship* and *social support* [@wangBidirectionalEffectsExpressive2020], *autonomy* [@vrolijkLongitudinalLinkagesFather2020a; @brenningPerceivedMaternalAutonomy2015], *sexual risk* [@brownDepressiveSymptomsPredictor2006], and *loneliness* [@spithovenItAllTheir2017].
The fact that these constructs are absent from the graph does not suggest that they are unimportant.
Rather, it indicates that they are not yet well-integrated in the broader literature on adolescents' emotion regulation,
and are therefore prime candidates for future research.<!-- RK: Or could they also suggest that they were relevant in the past, but not any longer? Might it be important to run sensitivity analyses by publication year?
One recommendation for future research might be to study such important but unembedded constructs
in conjunction with other more well-established constructs,
as such an approach might help fill gaps in existing knowledge.-->

# Analysis 2: Abstract text mining

```{r}
library(stringr)
library(udpipe)
library(igraph)
library(wordcloud)
library(Matrix)
library(yaml)
library(Rmpfr)
library(topicmodels)
library(udpipe)
library(slam)
library(tidytext)
library(ggplot2)
library(textrank)
source("word_functions.R")
source("circle2.R")

if(isTRUE(tools::md5sum("study2_df.RData") == "21abb2622dfd94d8bd3473ed56697f9e")){
  df <- readRDS("study2_df.RData")
} else {
  stop("Note: Study 2 file is out of date. Please run this code manually.")
  recs <- data.table(read.csv("recs_final.csv"))
  if(!is.data.table(recs)){
    browser()
  }
  recs[, "doc" := 1:nrow(recs)]
  
  recs$AB <- tolower(recs$AB)
  if(!file.exists("english-ewt-ud-2.4-190531.udpipe")) {
    ud_model <- udpipe_download_model(language = "english")
  } else {
    ud_model <- udpipe_load_model("english-ewt-ud-2.4-190531.udpipe")
    ud_model <- udpipe_load_model(ud_model$file)
  }
  udp_res <- udpipe_annotate(ud_model, x = recs$AB, doc_id = recs$doc)
  df <- as.data.table(udp_res)
  saveRDS(df, "study2_df.RData")
}


# LDA analysis ------------------------------------------------------------

if(!isTRUE(tools::md5sum("Study2_lda_dims.txt") == "2d00a24d8b54ac898eec6cd104086a0f")){
  # Functions:
  harmonicMean <- function(logLikelihoods, precision = 2000L) {
    llMed <- median(logLikelihoods)
    as.double(llMed - log(mean(exp(-mpfr(logLikelihoods,
                                         prec = precision) + llMed))))
  }
  BIC <- function(ll, p, n){
    -2 * ll + p * log(n)
  }
  entropy <- function(post_prob){
    1 + (1/(nrow(post_prob) * 
              log(ncol(post_prob)))) * (sum(rowSums(post_prob * 
                                                      log(post_prob + 1e-12))))
  }
  
  # Preprocessing -----------------------------------------------------------
  
  # Frequency of word by doc
  nounbydoc <- df[df$upos %in% c("NOUN", "ADJ"), list(freq = .N), by = list(doc_id = doc_id, term = lemma)]
  df_lda <- nounbydoc #[nounbydoc$term %in% names(dict), ]
  df_lda <- df_lda %>%
    bind_tf_idf(term, doc_id, freq)
  summary(df_lda$tf_idf)
  
  select_words <- df_lda[!duplicated(df_lda$term), ]
  select_words <- select_words$term[select_words$tf_idf >= median(select_words$tf_idf)]
  df_lda <- df_lda[df_lda$term %in% select_words, ]
  
  dtm <- udpipe::document_term_matrix(document_term_frequencies(df_lda))
  yaml::write_yaml(dim(dtm), file = "Study2_lda_dims.txt")
  
  # Build topic models
  seqk <- seq(2, 20, 1)
  burnin <- 1000
  iter <- 1000
  keep <- 50
  set.seed(44773)
  res_lda <- lapply(seqk, function(k) {
    topicmodels::LDA(
      dtm,
      k = k,
      method = "Gibbs",
      control = list(
        burnin = burnin,
        iter = iter,
        keep = keep
      )
    )
  })
  
  ll <- sapply(res_lda, function(x){harmonicMean(x@logLiks[-c(1:(burnin/keep))])})
  
  K = seqk
  N = nrow(dtm)
  M = ncol(dtm)
  
  parameters <- K*(M-1)+N*(K-1)
  N <- nrow(dtm)
  bics <- BIC(ll, parameters, N)
  
  entropies <- sapply(res_lda, function(x){entropy(x@gamma)})
  
  p <- ggplot(data.frame(K = seqk, Entropy = entropies), aes(x = K, y = Entropy)) + geom_path() +
    xlab('Number of topics') +
    scale_y_continuous(limits = c(0,1)) +
    theme_bw()
  
  ggsave("study2_entropies.png", p, device = "png")
  ggsave("study2_entropies.svg", p, device = "svg")
  
  p <- ggplot(data.frame(K = seqk, ll = ll), aes(x = K, y = ll)) + geom_path() +
    geom_vline(xintercept = (which.max(ll)+1), linetype = 2) +
    xlab('Number of topics') +
    geom_smooth(method = "lm", formula = y~log(x), se = FALSE)+
    theme_bw()
  
  ggsave("study2_ll.png", p, device = "png")
  ggsave("study2_ll.svg", p, device = "svg")
  
  p <- ggplot(data.frame(K = seqk, BIC = bics), aes(x = K, y = BIC)) + geom_path() +
    geom_vline(xintercept = (which.min(bics)+1), linetype = 2) +
    xlab('Number of topics') +
    geom_smooth(method = "lm", formula = y~x, se = FALSE)+
    theme_bw()
  
  ggsave("study2_BIC.png", p, device = "png")
  ggsave("study2_BIC.svg", p, device = "svg")
}


# Keyword extraction ------------------------------------------------------

# Exclude words
if(isTRUE(tools::md5sum("study2_df_kw.RData") == "8c9b3d61fa7e9bb6a3b31962b11face1")){
  df_kw <- readRDS("study2_df_kw.RData")
} else {
  df_kw <- df[upos %in% c("NOUN", "ADJ"), ]
  df_kw <- df_kw[grepl("^[a-zA-Z].", df_kw$lemma), ]
  exclude_terms <- readLines("exclude_terms.txt")
  exclude_these <- unique(unlist(lapply(exclude_terms, grep, x = df_kw$lemma)))
  df_kw <- df_kw[-exclude_these, ]
  saveRDS(df_kw, "study2_df_kw.RData")
}

# No numeric values
# all(is.na(as.numeric(df_kw$lemma)))
#df_kw$lemma[nchar(df_kw$lemma) == 3]

if(isTRUE(tools::md5sum("study2_textrank.RData") == "dcaf7c9bab7a4abd86d19d4868fad780")){
  kw_tr <- readRDS("study2_textrank.RData")
} else {
  kw_tr <- textrank_keywords(x = df_kw$lemma[df_kw$upos %in% c("NOUN", "ADJ")], 
                             ngram_max = 3, sep = " ")
  saveRDS(kw_tr, "study2_textrank.RData")
}

if(isTRUE(tools::md5sum("study2_df_analyze.RData") == "e50ee4984e0872947342d868e3bc9144")){
  df_analyze <- data.table(readRDS("study2_df_analyze.RData"))
} else {
  # Merge back with original data
  df_kw$keyword <- txt_recode_ngram(df_kw$lemma, compound = kw_tr$keywords$keyword, ngram = kw_tr$keywords$ngram, sep = " ")
  df_kw$keyword[!df_kw$keyword %in% kw_tr$keywords$keyword] <- NA
  
  df_analyze <- df_kw[!is.na(df_kw$keyword), ]
  dict <- read_yaml("yaml_dict.txt")
  res_cat <- cat_words(df_analyze$keyword, dict, handle_dups = "all")
  # Check coding issues
  #res_cat$dup
  #head(res_cat$unmatched)
  df_analyze <- merge_df(df_analyze, res_cat$words, "word_coded")
  saveRDS(df_analyze, "study2_df_analyze.RData")
}


# Wordcloud ---------------------------------------------------------------
# Frequency of word by doc
if(!is.data.table(df_analyze)) stop("Not a data.table")
nounbydoc <- df_analyze[, list(freq = .N), by = list(doc_id = doc_id, term = word_coded)]
number_docs_words2 <- c(docs = length(unique(nounbydoc$doc_id)), words = length(unique(nounbydoc$term)))

nounbydoc$freq <- 1
dtm <- udpipe::document_term_matrix(document_term_frequencies(nounbydoc))
topterms <- colSums(dtm)
topterms <- sort(topterms, decreasing = TRUE)

# Select most common terms ------------------------------------------------
set.seed(720)
dtm_top <- dtm[, select_words(dtm, .975)]
dtm_top <- dtm_top[rowSums(dtm_top) > 0, ]

if(run_everything){

  # Wordcloud ---------------------------------------------------------------
  
  ## Word frequencies
  topterms <- colSums(dtm_top)
  topterms <- sort(topterms, decreasing = TRUE)
  word_freq <- data.frame(Word = names(topterms), Frequency = topterms, row.names = NULL)
  write.csv(word_freq, "study2_word_freq.csv", row.names = FALSE)
  df_plot <- word_freq
  df_plot$Word <- pretty_words(df_plot$Word)
  df_plot$Frequency <- sqrt(df_plot$Frequency)
  ## Visualise them with wordclouds
  p <- quote({
    set.seed(46)
    wordcloud(words = df_plot$Word, freq = df_plot$Frequency, scale = c(4,.4), max.words = 150, rot.per = 0,  random.order = FALSE, colors = brewer.pal(8, "Dark2"))
  })
  
  svg("study2_wordcloud.svg")
  eval(p)
  dev.off()
  
  png("study2_wordcloud.png")
  eval(p)
  dev.off()
}

# Feature importance ------------------------------------------------------
topterms <- colSums(dtm_top)
if(run_everything){
  baseline <- readRDS("baseline.RData")
  
  word_freq <- data.frame(Word = names(topterms), Frequency = topterms, row.names = NULL)
  df_plot <- word_freq
  df_plot <- df_plot[order(df_plot$Frequency, decreasing = TRUE), ]
  categ <- read.csv("study1_categorization.csv", stringsAsFactors = FALSE)
  df_plot$cat <- categ$category[match(df_plot$Word, categ$name)]
  df_plot$faded <- df_plot$Word %in% baseline
  # Tag words that are not in the cooccurrence graph
  in_graph <- row.names(read.csv("s2_cooc.csv", row.names = 1))
  notingraph <- !df_plot$Word %in% in_graph
  italic_labels <- as.character(df_plot$Word)
  italic_labels[notingraph] <- sapply(italic_labels[notingraph], function(x){
    parse(text = paste0("italic('", x, "')"))
  })
  df_plot$Word <- pretty_words(df_plot$Word)
  
  
  df_plot$Word <- ordered(df_plot$Word, levels = df_plot$Word[order(df_plot$Frequency)])
  
  cat_cols <- c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "forestgreen")
  df_plot$cat <- ordered(df_plot$cat, levels = c("Outcome", "Indicator", "Cause", "Protective"))
  
  write_yaml(df_plot$Word, "s2_words.yml")
  
  
  p <- ggplot(df_plot, aes(y = Word, x = Frequency)) +
    geom_segment(aes(x = 0, xend = Frequency,
                     y = Word, yend = Word, linetype = notingraph), colour = "grey50"
    ) + 
    geom_vline(xintercept = 0, colour = "grey50", linetype = 1) + xlab("Word frequency") +
    geom_point(data = df_plot[df_plot$faded, ], aes(colour = cat), fill = "white", shape = 21, size = 1.5) +
    geom_point(data = df_plot[!df_plot$faded, ], aes(colour = cat, fill = cat), shape = 21, size = 1.5) +
    scale_colour_manual(values = c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "forestgreen"), guide = NULL)+
    scale_fill_manual(values = c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "forestgreen")) +
    scale_x_log10() +
    #scale_y_discrete(labels = italic_labels) +
    scale_linetype_manual(values = c("TRUE" = 3, "FALSE" = 1), guide = NULL) +
    theme_bw() + theme(panel.grid.major.x = element_blank(),
                       panel.grid.minor.x = element_blank(), axis.title.y = element_blank(),
                       legend.position = c(.70,.125),
                       legend.title = element_blank(),
                       axis.text.y = element_text(hjust=0, vjust = 0, size = 6))
  
  svg("s2_varimp.svg", width = 7/2.54, height = 14/2.54)
  eval(p)
  dev.off()
  
  ggsave("s2_varimp.png", p, device = "png", width = 7, height = 14, units = "cm")
}

# Co-occurrence -----------------------------------------------------------
set.seed(5646)
cooc <- select_cooc(create_cooc(dtm_top), q = .975)

if(run_everything){
  write.csv(as.matrix(cooc), "s2_cooc.csv")
  df_plot <- as_cooccurrence(cooc)
  df_plot <- df_plot[!df_plot$term1 == df_plot$term2, ]
  df_plot <- df_plot[order(df_plot$cooc, decreasing = TRUE), ]
  
  df_plot$id <- apply(df_plot[, c("term1", "term2")], 1, function(x)paste0(sort(x), collapse = ""))
  df_plot <- df_plot[!duplicated(df_plot$id), ]
  
  # Create network ----------------------------------------------------------
  
  edg <- df_plot
  edg$width = edg$cooc
  
  vert <- data.frame(name = names(topterms), label = pretty_words(names(topterms)), size = topterms)
  vert <- vert[vert$name %in% unique(c(edg$term1, edg$term2)), ]
  
  categ <- read.csv("study1_categorization.csv", stringsAsFactors = FALSE)
  if(any(!vert$name %in% categ$name)){
    write.table(vert$name[!vert$name %in% categ$name], "clipboard", sep = "\n", row.names = FALSE, col.names= FALSE)
    stop("Please re-categorize missing vertices.")
  } 
  vert$Category <- categ$category[match(vert$name, categ$name)]
  vert$faded <- vert$name %in% baseline
  
  cat_cols <- c(Outcome = "gray50", Indicator = "tomato", Cause = "gold", Protective = "olivedrab2")
  vert$color <- cat_cols[vert$Category]
  vert$frame.color <- cat_cols[vert$Category]

  vert$color[vert$faded] <- "#FFFFFF"
  
  
  vert$size <- scales::rescale(log(vert$size), c(4, 12))
  g <- graph_from_data_frame(edg, vertices = vert,
                             directed = FALSE)
  
  # edge thickness
  E(g)$width <- scales::rescale(sqrt(E(g)$width), to = c(.2, 8))
  dysreg_vertex = which(names(V(g)) == "dysregulation")
  
  edge.start <- ends(g, es=E(g), names = FALSE)[,1]
  edge.end <- ends(g, es=E(g), names = FALSE)[,2]
  # Color edges based on origin:
  #E(g)$color <- V(g)$color[edge.start]
  E(g)$lty <- c(1, 5)[(!(edge.start == dysreg_vertex|edge.end == dysreg_vertex))+1]
  
  set.seed(5) #4 #2 #3
  l1 <- l <- layout_with_fr(g)
  set.seed(3) #64
  l2 <- layout_in_circle(g, order = shifter(V(g), -1))
  
  p <- quote({
    # Set margins to 0
    par(mar=c(0,0,0,0),
        mfrow=c(1,2))
    plot(g, edge.curved = 0, layout=l1,
         vertex.label.family = "sans",
         vertex.label.cex = 0.8,
         vertex.shape = "circle2",
         #vertex.frame.color = 'gray40',
         vertex.label.color = 'black',      # Color of node names
         vertex.label.font = 1,         # Font of node names
         vertex.frame.width = 2
    )
    legend(x=-1.1, y=1.1, names(cat_cols), pch=21, col="#777777", pt.bg=cat_cols, pt.cex=2, cex=.8, bty="n", ncol=1)
    plot(g, edge.curved = 0, layout=l2,
         vertex.label.family = "sans",
         vertex.label.cex = 0.8,
         vertex.shape = "circle2",
         #vertex.frame.color = 'gray40',
         vertex.label.color = 'black',      # Color of node names
         vertex.label.font = 1,         # Font of node names
         vertex.frame.width = 2
    )
  })
  
  # Save files
  png("study2_network1.png", width = 960)
  eval(p)
  dev.off()
  
  svg("study2_network1.svg", width = 14)
  eval(p)
  dev.off()
}

word_freq <- read.csv("study2_word_freq.csv", stringsAsFactors = FALSE)
word_graph <- read.csv("s2_cooc.csv", row.names = 1)
notingraph <- word_freq$Word[!word_freq$Word %in% row.names(word_graph)]
notingraph <- categ[categ$name %in% notingraph, ]
cats <- unique(notingraph$category)
notingraph <- lapply(cats, function(x){ 
  out <- notingraph$name[notingraph$category == x]
  out <- pretty_words(out)
  paste0(paste0("*", out[-length(out)], "*", collapse = ", "), ", and *", tail(out, 1), "*")
})
names(notingraph) <- cats
lda_dims_2 <- read_yaml("Study2_lda_dims.txt")

```

The corpus for this second analysis consisted of the abstracts of the selected articles.
Keywords, as examined in Analysis 1, convey high-quality information because they are carefully chosen by authors to capture the essence of a study.
However, as authors are
typically limited to 5 keywords, some nuance may be lost.
Abstracts, by contrast, offer greater freedom of expression,
but present a greater challenge when it
comes to extracting relevant information.
To perform feature extraction,
we first applied the natural language processing technique "part-of-speech tagging" (POS-tagging), which identifies a word's grammatical function within the sentence context.
Then, we used POS-tagging to retain only nouns and adjectives,
which helps derive more interpretable text mining models [@martinMoreEfficientTopic2015].
Finally, we used stemming to reduce the retained terms to their root form.

## Structural topic modeling

To assess the homogeneity of the corpus of abstracts,
we again conducted topic modeling,
following the procedure described in Analysis 1.
The data comprised `r lda_dims_2[2]` terms in `r lda_dims_2[1]` documents.
As before, the BICs followed a linearly increasing trend, and entropies were near-zero.
Thus, no subcorpora were identified,
and we proceed with a whole sample analysis.

## Identifying keywords

When conducting text mining analysis on unstructured text data (as opposed to author key words), focusing on individual words out of context can reduce interpretability.
For instance, our core construct "emotion dysregulation" is already a bigram.
To identify more meaningful units of analysis,
we applied the `textrank` algorithm [@wijffelsTextrankSummarizeText2019], an extention of Google's PageRank [@pageMethodNodeRanking2006], to identify relevant $n$-grams (with $n \leq 3$).
The resulting $n$-grams were merged with the original data.
After applying the dictionary and exclusion filter as explained in Analysis 1,
the resulting corpus consisted of `r number_docs_words2[1]` documents with `r number_docs_words2[2]` unique words.
Terms exceeding the $97.5^{th}$ percentile of a negative binomial distribution were retained for analysis.
The identified important keywords are displayed in Figure \@ref(fig:study2varimp).

```{r study2varimp, eval = TRUE, out.width = "100%", results='asis', fig.cap="Document frequency of terms selected for Study 2. Transparent circles indicate constructs represented in theory (Figure 1), dotted lines indicate constructs absent from the co-occurrence graph."}
knitr::include_graphics("s2_varimp.png") 
# fig_svg <- cowplot::ggdraw()+cowplot::draw_image("s1_varimp.svg")
# plot(fig_svg)
```

## Mapping the literature

A term co-occurrence matrix was constructed following the procedure described in Analysis 1.
Figure \@ref(fig:study2network) displays the resulting matrix as a force directed graph.

```{r study2network, out.width = "100%", fig.cap="Study 2 term co-occurrence. Two layouts are presented to aid interpretation. Size of lines and circles represents frequency. Dashed lines represent links not involving dysregulation. Transparent circles indicate constructs also represented in the theory (cf Figure 1)."}
#knitr::include_graphics("study2_network1.svg")
library(cowplot)
fig_svg <- cowplot::ggdraw()+cowplot::draw_image("study2_network1.svg")
plot(fig_svg)
```

## Results

```{r}
s1 <- read_yaml("s1_words.yml")
s2 <- read_yaml("s2_words.yml")

#length(unique(c(s1, s2)))

oneintwo <- round(length(s1[s1 %in% s2])/length(s1)*100)
twoinone <- round(length(s2[s2 %in% s1])/length(s2)*100)

s1order <- data.frame(word = s1, order = 1:length(s1))
s2order <- data.frame(word = s2, order = 1:length(s2))
orders <- merge(s1order, s2order, by = "word", all = TRUE)
orders[is.na(orders)] <- 999
names(orders) <- c("word", "order1", "order2")
orders$diff <- orders$order1-orders$order2
orders <- orders[order(abs(orders$diff), decreasing = TRUE), ]
```

Based on term document frequency, there was substantial agreement between the findings of Analysis 1 and 2;
$`r oneintwo`\%$ of the most frequent terms identified in the author keywords
were also present in the abstracts,
and conversely, $`r twoinone`\%$ of the most frequent terms from the abstracts were present in the keywords.
In the corpus of abstracts,
emotion dysregulation and its mental health outcomes were evidently the most common terms.
The term *neural* again occurred frequently.
The term *sex* was more frequent than in Analysis 1,
suggesting that sex differences are regularly reported in Abstracts.
The term *parenting*, which ranked highly in the preceding keyword Analysis, was displaced by *mothers* amonst the top-ranking terms.
This suggests that when the keyword *parenting* is used,
the abstract will often reveal that this was operationalized in terms of mothering [as noted by @pleckPaternalInvolvementRevised2004].

```{r, echo = FALSE}
categ <- read.csv("study1_categorization.csv", stringsAsFactors = FALSE)
connected <- cooc[which(rownames(cooc) == "dysregulation"), ]
connected <- names(connected)[connected > 0]
connected <- connected[connected %in% categ$name[categ$category == "Cause"]]
```

Inspecting the co-occurrence graph for the keyword data,
we see a much sparser network than in Analysis 1, with a different structure.
We now see that dysregulation and mental health-related terms form a central axis,
and that many related terms are connected to this axis, but not always directly to
dysregulation. Only the terms *neural*, *mothers*, *attachment* and *ptsd* are 
connected directly to dysregulation.
Many prevalent terms were absent from the co-occurrence graph,
as they were not strongly related to any other terms. 
These terms include the potential causes `r notingraph["Cause"]`, the potential outcomes `r notingraph["Outcome"]`, and the potential protective factors `r notingraph["Protective"]`.

## Discussion

This second analysis focused on the abstracts of the reviewed articles.
Several themes emerged from the terms newly identified in this analysis,
relative to the theoretical review.
These themes bear considerable similarity to the results of Analysis 1.
Developmental disorders and physical health are both recurring themes, but are ranked much lower in the present analysis.
External stressors are another recurring theme, with indicators including PTSD, bullying, stress, abuse, historic events, and divorce.
Finally, structural disadvantage recurs,
as reflected in minority status and discrimination, disability status, socio-economic status, adoption status, sexual diversity, and the aforementioned developmental disorders.

A new theme emerging from this analysis is addictive behavior, with highly ranked indicators *substance use* and *device use*.
Another new theme pertains to identity and moral development, two topics with a common root in theory [@lapsleyMoralIdentityDevelopmental2015]. This theme is also reflected by the terms *values* and *personality*. 
Finally, sexual development emerges as a theme. Aside from the high-ranking construct (biological) *sex*, this theme is reflected in the terms *puberty*, *sexual diversity*, and *romantic*.

We observed a sparser network, with fewer selected terms.
This is likely an artifact of the unstructured nature of abstracts,
which introduces greater noise in the analysis.
Thus, fewer terms will exceed the detection threshold.
Nonetheless, the remaining terms displayed substantial consistency with the
analysis of author keywords.
This supports the validity of the findings,
suggesting that automatic keyword extraction from abstracts can identify relevant constructs,
and may constitute a suitable alternative to author-provided keywords.

The emergence of a "central axis" of dysregulation and mental health-related outcomes
again suggest that these phenomena are consistently studied together.
This makes sense, given the central role of emotion dyregulation in the etiology of diverse mental health problems [@leeAdolescentMentalHealth2014].
This is in contrast to the lack of interconnectivity among other related constructs,
which once more suggests that the literature is somewhat fragmented.
This impression is further reinforced by the absence of many frequently occurring terms
from the term co-occurrence graph.

# General Discussion

<!--it is worth noting that many different theories of *emotion* exist, and yet there is relatively little attention for the subtleties of 
distinct from theories of emotional development, and that there is no one-to-one relationship between theories of emotion (regulation) development and theories of emotion. This issue is beyond the scope of the present study -->
The present study systematically reviewed the literature,
and used text-mining to map constructs related to adolescent emotion regulation.
The results of this inductive approach echoed many of the constructs considered
relevant in the theoretical literature.
This suggests that the text mining method can indeed be used to map relevant themes in the literature.
Our analysis also revealed several themes that have been underrepresented in theories of adolescent emotion regulation,
but nonetheless occur frequently in the empirical literature.
These themes include developmental disorders, physical health, external stressors, structural disadvantage, addictive behavior, identity and moral development, and sexual development.

It is important to identify such under-theorized areas of the literature because
researchers typically rely on theoretical foundations when planning a study.
By providing a conceptual overview of the empirical literature,
the present study offers some preliminary guidance regarding potentially relevant topics to consider.
An important direction for future research would be to formalize these inductive insights into a new overarching theory of adolescent emotion regulation.
In doing so, the co-occurrence graphs of relevant constructs arising from our inductive review may serve as a template for a nomological network:
a proto-theoretical diagrammatic representation that describes relationships between
constructs relevant to the theory.
The generation of such nomological networks constitutes a first step in theory generation [see @alaviAligningTheoryMethodology2018].

Additional insight can be gleaned from the structure of the co-occurrence graphs.
First, both analyses revealed close ties between emotion regulation and mental health-related outcomes.
This is consistent with emotion regulation's putative implication in the etiology of various mental health problems [see @leeAdolescentMentalHealth2014].
It further emphasizes the societal relevance of this field of research.
Both analyses further revealed that most constructs were
directly tied to emotion dysregulation or its mental health correlates,
with few connections among constructs.
This sparse property of the networks echoes the sentiment by @bussTheoriesEmotionalDevelopment2019
that the literature is somewhat fragmented.
The present study takes a first step towards integrating this diffuse field
by using a relatively comprehensive and objective method, compared to narrative reviews.
An important future direction for research might be to jointly investigate disconnected constructs, as the lack of connections in the graph indicates a potential knowledge vacuum.

Our work represents one of the first efforts to comprehensively map the literature on adolescents' emotion dysregulation [cf. @bariolaChildAdolescentEmotion2011; @coe-odessEmergentEmotionsAdolescence2019].
It is also one of the first applications of inductive text mining methods in a systematic review.
Text mining reviews offer some potential advantages when compared to narrative literature reviews [@littellEvidencebasedBiasedQuality2008]:
They can cover vastly greater corpora than a human reader,
and follow a somewhat more objective, transparant, and reproducible procedure.
As such, text mining reviews offer an interesting perspective that complements theory and narrative reviews.

Of course, the present study also has limitations.
One key limitation is that the text mining techniques used here
are not able to extract *meaning* from the literature in the way a sentient reader would, an cannot substantively interpret connections between constructs.
This limitation is best addressed by considering the output of our text mining analysis as a starting point for further inductive thought or a more in-depth reading of a particular subset of the literature.
Throughout this paper, we have offered our interpretation of the results -
but we also encourage readers to use these results as impetus for independent reflection,
and inspiration for future deductive research.
A related limitation is that our methods do not capture the nature of the relationship between co-occurring terms.
Instead, we manually classified terms as potential causes, outcomes, protective factors, or indicators based on domain knowledge.
Efforts are currently underway to develop unsupervised algorithms capable of distilling causal links from bodies of scientific abstracts [@anExtractingCausalRelations2019].
Future research might substantially advance theory formation by applying such methods to the present corpus.
<!--For example, a human reader would understand that the influence of mothers and fathers both
falls under the header of "parenting". 
Furthermore, a human reader would swiftly learn that the term "parenting" has historically been used primarily to represent maternal influences,
and has increasingly come to represent paternal influence as well. -->
One final limitation is that our analysis was limited to keywords and abstracts.
Analysis of full-text papers would undoubtedly yield additional insights.
Regrettably, paywalls and the lack of a unified API currently prevent such analysis.
This highlights the importance of open science: 
With comprehensive open access publishing, we may one day be able to mine the entire published literature for insights.
The recent release of 100k+ full-text papers on COVID-19 for text mining analysis on <kaggle.com> is proof of concept for this approach.

To conclude, this paper set out to map the factors associated with adolescents' emotion dysregulation, based on a systematic review of the literature, and text mining analysis of author keywords and abstracts.
We provided a map of the literature on adolescents' emotion dysregulation,
covering both familiar ground, and charting unknown territories.
Our results suggested that several key themes are currently underrepresented in theory,
and that the empirical literature is somewhat fragmented by sub-topic.
These inductive insights are relevant for the design of new deductive studies which,
even though grounded in theory,
might benefit from incorporating additional relevant factors
to better elucidate the nature of their association with adolescents' emotion dysregulation.
Our analysis also identified several factors currently on the fringes of the literature,
which might represent emerging themes that would benefit from further research [including, for example, the role of fathers @vanlissaMothersFathersQuantitative2020].
One recommendation for future research might be to study such important but unembedded constructs
in conjunction with other more well-established constructs,
to bridge gaps in existing knowledge.
Several authors have commented on the lack of an overarching theory tailored specifically to adolescent emotion dysregulation.
The present work might serve as a starting point for future theory development,
with the aim of incorporating themes from the empirical literature within the framework of existing relevant theory.

\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup

















































